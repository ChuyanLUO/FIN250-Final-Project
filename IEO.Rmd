---
title: "Final Project"
output: html_document
---
```{r}
library(forecast)
library(zoo)
library(xts)
library(urca)

IEO<-read.csv("~/Documents/Fall 2018/Forecasting/R Codes/Data Sets/IEO.csv")
IEO.ts <- xts(IEO$Adj.Close, as.Date(IEO$Date))
vol <- (diff(log(IEO.ts)))^2
plot(IEO.ts)
plot(vol)
Acf(IEO.ts)
Pacf(IEO.ts)
Acf(vol)
Pacf(vol)

train.ts <- window(IEO.ts, end = "2014-08-31")
valid.ts <- window(IEO.ts, start = "2014-09-01")
ntrain <- length(train.ts)
nvalid <- length(valid.ts)

#DF Test on Whole Data Set
df.test <- ur.df(IEO.ts,type="trend",selectlags="BIC")
print(summary(df.test))
sum <- summary(df.test)
teststat <- sum@teststat[3]
# critical value at 5 percent
critical <- sum@cval[3,2]
abs(critical)<abs(teststat) #Not reject null, series has unit root

# Arima Forecast
ArimaMod <- auto.arima(train.ts, d=1, ic="bic", seasonal = FALSE)
summary(ArimaMod)
fcast_Arima <- Arima(valid.ts, model = ArimaMod)
fcast_fitted_Arima <- xts(fcast_Arima$fitted, as.Date(IEO$Date[(ntrain+1):(ntrain+nvalid)]))
mod_fitted_Arima <- xts(ArimaMod$fitted, as.Date(IEO$Date[1:ntrain]))

print(accuracy(ArimaMod))
print(accuracy(fcast_Arima$fitted, valid.ts))

plot(IEO.ts, ylab="Price",xlab="Time",bty="l",ylim=c(0,100),main="Forecast of IEO Price(Arima(0,1,0))", flty=2)
lines(mod_fitted_Arima, lwd=1,col="blue")
lines(fcast_fitted_Arima, lwd=1,col="green")

# Exponential Filter Forecast
# First, estimate addiive trend filter
filter.mod <- ets(train.ts, model = "AAN")
# Now, build forecasts for validation periods (uses no data there)
filter.pred <- forecast(filter.mod, h = nvalid))
# Now, build one step ahead forecasts for validation data, using estimated model
filter.onestep <- ets(valid.ts, model = filter.mod)
filter.pred.fitted <- xts(filter.pred$fitted, as.Date(IEO$Date[1:ntrain]))
filter.onestep.fitted <- xts(filter.onestep$fitted, as.Date(IEO$Date[(ntrain + 1):(ntrain + nvalid)]))
# plot all the results
plot(IEO.ts, main = "Filter Forecast (with trend)")
lines(filter.pred.fitted, lwd = 1,col="blue", lty = 2)
lines(filter.onestep.fitted,lwd = 1, col="green", lty = 2)
# check accuracy
print(accuracy(filter.pred, valid.ts))
print(accuracy(filter.onestep$fitted, valid.ts))

# Naive Forecast
nALL <- length(IEO.ts)
naiveFcast.ts <- lag(IEO.ts, 1)
naiveTrain.ts <- window(naiveFcast.ts, end=("2014-08-31"))
naiveValid.ts <- window(naiveFcast.ts, start =("2014-09-01"))
# plot
plot(IEO.ts, main = 'Naive Forecast')
lines(naiveTrain.ts,col = "blue")
lines(naiveValid.ts, col = "green")
# RMSE
(sqrt(mean((naiveTrain.ts-train.ts)^2, na.rm =TRUE)))
(sqrt(mean((naiveValid.ts-valid.ts)^2, na.rm =TRUE)))

```
